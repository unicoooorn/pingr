prometheus:
  url: "http://prometheus:9090"
  timeout: 2s

backends:
  service1:
    type: http
    url: "http://service1:8081/health"
    timeout: 2s
    metrics_queries:
      - "rate(get_value_duration_seconds_sum[5m]) / rate(get_value_duration_seconds_count[5m])"
      - "increase(get_value_requests_total[5m])"
      - "app_cpu_usage_percent"
      - "app_mem_usage_percent"
      - "max_over_time(app_mem_usage_percent[5m])"
      - "avg_over_time(app_mem_usage_percent[5m])"

  service2:
    type: http
    url: "http://service2:8082/health"
    timeout: 2s
    metrics_queries:
      - "rate(get_value_duration_seconds_sum[5m]) / rate(get_value_duration_seconds_count[5m])"
      - "increase(get_value_requests_total[5m])"
      - "app_cpu_usage_percent"
      - "app_mem_usage_percent"
      - "max_over_time(app_mem_usage_percent[5m])"
      - "avg_over_time(app_mem_usage_percent[5m])"

  svc_aggregator:
    deps: ["service1", "service2"]
    type: http
    url: "http://svc_aggregator:8083/health"
    timeout: 2s
    metrics_queries:
      - "rate(get_value_duration_seconds_sum[5m]) / rate(get_value_duration_seconds_count[5m])"
      - "increase(get_value_requests_total[5m])"
      - "app_cpu_usage_percent"
      - "app_mem_usage_percent"
      - "max_over_time(app_mem_usage_percent[5m])"
      - "avg_over_time(app_mem_usage_percent[5m])"
  
  svc_common:
    deps: ["svc_aggregator"]
    type: http
    url: "http://svc_common:8080/health"
    timeout: 2s
    metrics_queries:
      - "rate(get_value_duration_seconds_sum[5m]) / rate(get_value_duration_seconds_count[5m])"
      - "increase(get_value_requests_total[5m])"
      - "app_cpu_usage_percent"
      - "app_mem_usage_percent"
      - "max_over_time(app_mem_usage_percent[5m])"
      - "avg_over_time(app_mem_usage_percent[5m])"
  
  spammer:
    deps: ["svc_common"]
    type: tcp
    host: spammer
    port: 7777
    timeout: 2s